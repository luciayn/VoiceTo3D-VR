<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>VoiceTo3D</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Load the A-Frame library -->
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    
    <!-- Remove A-Frame's default grabbable component -->
    <script>
        delete AFRAME.components["grabbable"];
    </script>

    <!-- Load A-Frame environment components for VR interactions -->
    <script src="https://unpkg.com/aframe-environment-component@1.5.x/dist/aframe-environment-component.min.js"></script>
    <!-- Load additional A-Frame community components -->
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.5.4/dist/aframe-extras.min.js"></script>
    <!-- Hands Interactions (Grabbing, stretching, dragging, etc.) -->
    <script src="https://cdn.jsdelivr.net/npm/super-hands@3.0.5/dist/super-hands.min.js"></script>
    <!-- Physics -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/@c-frame/aframe-physics-system@4.2.3/dist/aframe-physics-system.min.js"></script> -->
    <!-- Events, e.g. hover hand over cube -->
    <script src="https://cdn.jsdelivr.net/npm/aframe-event-set-component@5.1.0/dist/aframe-event-set-component.min.js"></script>
    <!-- More Physics -->
    <script src="https://cdn.jsdelivr.net/npm/aframe-physics-extras@0.1.3/dist/aframe-physics-extras.min.js"></script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css" />
</head>

<body>
    <!-- Browser UI -->
    <div id="ui-container">
      <div id="transcription">Transcription will appear here...</div>
      <button id="mic-button">Start Listening</button>
      <div id="status">Disconnected from server</div>
    </div>

    <!-- A-Frame VR Scene -->
    <a-scene environment physics>
        <a-assets>
            <a-mixin id="model" hoverable grabbable stretchable draggable event-set__hoveron="_event: hover-start; material.opacity: 0.7; transparent: true"
                event-set__hoveroff="_event: hover-end; material.opacity: 1; transparent: false" dynamic-body
                shadow></a-mixin>

            <a-mixin id="touch" physics-collider phase-shift collision-filter="collisionForces: false"
                static-body="shape: sphere; sphereRadius: 0.02" super-hands="colliderEvent: collisions;
                         colliderEventProperty: els;
                         colliderEndEvent: collisions;
                         colliderEndEventProperty: clearedEls;">
            </a-mixin>
        </a-assets>

        <!-- Lighting -->
        <a-entity light="type: ambient; intensity: 0.5"></a-entity>
        <a-entity light="type: directional; intensity: 0.8" position="1 3 2"></a-entity>

        <!-- Ground -->
        <a-plane static-body material="color: #e0e0e0; transparent: true; opacity: 0" id="ground" rotation="-90 0 0" width="100" height="100"></a-plane>

        <!-- Camera and Controllers -->
        <a-entity id="rig" joystick-movement="speed: 1.5" joystick-rotation="speed: 60" update-environment>
            <a-camera id="camera" position="0 1.6 0">
              <!-- Pointing Instructions -->
              <a-entity id="pointing-instructions-text"
                        text="value: ; align: center; width: 3"
                        position="0 1 -2"
                        visible="false">
              </a-entity>
            </a-camera>
            <a-entity id="rightHand" mixin="touch" hand-controls="hand: right; handModelStyle: lowPoly"
              raycaster="enabled: false; objects: [semantic-node], #ground; far: 10; showLine: true; direction: 0 -1 0;">
            </a-entity>
            <a-entity id="leftHand" mixin="touch" hand-controls="hand: left; handModelStyle: lowPoly">
            </a-entity>
        </a-entity>

        <!-- Sky (Background) -->
        <a-sky color="#ADD8E6"></a-sky>
    </a-scene>

    <!-- Custom JS -->
    <!-- Joystick Rotation -->
    <script src="js/joystick.js"></script>
    <!-- WebSocket Connection -->
    <script src="js/websocket.js"></script>
    <!-- Audio Handling -->
    <script src="js/audio.js"></script>
    <!-- Models Handling-->
    <script src="js/models.js"></script>
    <!-- Update Environment -->
    <script src="js/environment.js"></script>
    <!-- Main Application Logic -->
    <script src="js/main.js"></script>
</body>

</html>